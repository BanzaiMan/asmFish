version: 3.0.{build}
pull_requests:
  do_not_increment_build_number: true
max_jobs: 11
platform: Any CPU
clone_folder: C:\Projects\asmFish
build_script:
- cmd: "if exist fasmg.exe del fasmg.exe\ncall cscript /nologo \"%AppVeyor_Build_Folder%download.vbs\" https://flatassembler.net fasmg.zip fasmg.exe fasmg.exe \"The latest fasmg assembler\"\nfor /f \"tokens=2 delims==\" %%a in ('wmic OS Get localdatetime /value') do set \"dt=%%a\"\nset \"YY=%dt:~2,2%\" & set \"YYYY=%dt:~0,4%\" & set \"MM=%dt:~4,2%\" & set \"DD=%dt:~6,2%\"\nset \"HH=%dt:~8,2%\" & set \"Min=%dt:~10,2%\" & set \"Sec=%dt:~12,2%\"\nset \"datestamp=%YYYY%-%MM%-%DD%\" & set \"timestamp=%HH%%Min%%Sec%\" & set \"fullstamp=%YYYY%-%MM%-%DD%_%HH%%Min%%Sec%\"\nrmdir WindowsOS_binaries /s /q\nrmdir LinuxOS_binaries /s /q\nrmdir MacOS_binaries /s /q\nrmdir Matefinder_binaries /s /q\ndel *.exe /q\nmkdir WindowsOS_binaries\nmkdir Matefinder_binaries\nmkdir MacOS_binaries\nmkdir LinuxOS_binaries\nset t0=%time: =0%\nECHO === Building Windows Executables ===\nset include=x86\\include\\\nfasmg.exe \"x86\\fish.asm\" \"asmFishW_%datestamp%_popcnt.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'popcnt'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishW_%datestamp%_bmi1.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi1'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishW_%datestamp%_bmi2.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi2'\" %debug%\nECHO === Building Linux Executables ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishL_%datestamp%_popcnt\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'popcnt'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishL_%datestamp%_bmi1\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi1'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishL_%datestamp%_bmi2\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi2'\" %debug%\nECHO === Building MacOS Executables ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishX_%datestamp%_popcnt\" -e 1000 -i \"VERSION_OS='X'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'popcnt'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishX_%datestamp%_bmi1\" -e 1000 -i \"VERSION_OS='X'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi1'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"asmFishX_%datestamp%_bmi2\" -e 1000 -i \"VERSION_OS='X'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'bmi2'\" %debug% \nset include=arm\\include\\\nECHO === Building Windows Matefinder Executables ===\nset include=x86\\include\\\nfasmg.exe \"x86\\fish.asm\" \"mateFishW_%datestamp%_popcnt.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"VERSION_POST = 'popcnt'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishW_%datestamp%_bmi1.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"VERSION_POST = 'bmi1'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishW_%datestamp%_bmi2.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"VERSION_POST = 'bmi2'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building Linux Matefinder Executables ===\nfasmg.exe \"x86\\fish.asm\" \"mateFishL_%datestamp%_popcnt\" -e 1000 -i \"VERSION_OS='L'\" -i \"VERSION_POST = 'popcnt'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishL_%datestamp%_bmi1\" -e 1000 -i \"VERSION_OS='L'\" -i \"VERSION_POST = 'bmi1'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishL_%datestamp%_bmi2\" -e 1000 -i \"VERSION_OS='L'\" -i \"VERSION_POST = 'bmi2'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building MacOS Matefinder Executables ===\nfasmg.exe \"x86\\fish.asm\" \"mateFishX_%datestamp%_popcnt\" -e 1000 -i \"VERSION_OS='X'\" -i \"VERSION_POST = 'popcnt'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishX_%datestamp%_bmi1\" -e 1000 -i \"VERSION_OS='X'\" -i \"VERSION_POST = 'bmi1'\" -i \"USE_MATEFINDER = 1\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishX_%datestamp%_bmi2\" -e 1000 -i \"VERSION_OS='X'\" -i \"VERSION_POST = 'bmi2'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building Windows Base Executables ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishW_%datestamp%_base.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" %debug%\necho.\nfasmg.exe \"x86\\fish.asm\" \"mateFishW_%datestamp%_base.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building Linux Base Executables ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishL_%datestamp%_base\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishL_%datestamp%_base\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building MacOS Base Executables ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishX_%datestamp%_base\" -e 1000 -i \"VERSION_OS='X'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishX_%datestamp%_base\" -e 1000 -i \"VERSION_OS='X'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building Windows Base Executable ===\nfasmg.exe \"x86\\fish.asm\" \"asmFishW_%datestamp%_base.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" %debug%\nfasmg.exe \"x86\\fish.asm\" \"mateFishW_%datestamp%_base.exe\" -e 1000 -i \"VERSION_OS='W'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'base'\" -i \"USE_MATEFINDER = 1\" %debug%\nECHO === Building ARM Executables ===\nset include=arm\\include\\\nfasmg.exe \"arm\\fish.arm\" \"armFishL_%datestamp%_v8\" -e 1000 -i \"VERSION_OS='L'\" -i \"PEDANTIC = 1\" -i \"VERSION_POST = 'v8'\" %debug%\nstart /min fasmg.exe \"arm\\fish.arm\" \"mateFishL_%datestamp%_v8\" -e 1000 -i \"VERSION_OS='L'\" -i \"VERSION_POST = 'v8'\" -i \"USE_MATEFINDER = 1\" %debug%\nmove asmFishW* WindowsOS_binaries\nmove asmFishL* LinuxOS_binaries\nmove armFishL* LinuxOS_binaries\nmove asmFishX* MacOS_binaries\nmove mateFish* Matefinder_binaries\nset t=%time: =0%\nset /a h=1%t0:~0,2%-100\nset /a m=1%t0:~3,2%-100\nset /a s=1%t0:~6,2%-100\nset /a c=1%t0:~9,2%-100\nset /a starttime = %h% * 360000 + %m% * 6000 + 100 * %s% + %c%\nset /a h=1%t:~0,2%-100\nset /a m=1%t:~3,2%-100\nset /a s=1%t:~6,2%-100\nset /a c=1%t:~9,2%-100\nset /a endtime = %h% * 360000 + %m% * 6000 + 100 * %s% + %c%\nset /a runtime = %endtime% - %starttime%\necho      Build time: %runtime:~0,-2%.%runtime:~-2% seconds"
test_script:

- cmd: >-
    cd WindowsOS_binaries
            asmFishW_%datestamp%_popcnt.exe bench
            asmFishW_%datestamp%_base.exe bench
            asmFishW_%datestamp%_bmi1.exe bench
            cd..
    
    cd Matefinder_binaries
            mateFishW_%datestamp%_bmi2.exe bench
            mateFishW_%datestamp%_popcnt.exe bench
            mateFishW_%datestamp%_base.exe bench
            mateFishW_%datestamp%_bmi1.exe bench
            cd..
artifacts:
- path: WindowsOS_binaries
  name: Windows
- path: Matefinder_binaries
  name: Matefinder
- path: LinuxOS_binaries
  name: Linux
- path: MacOS_binaries
  name: Mac
